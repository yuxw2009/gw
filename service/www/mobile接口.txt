1 mobile start call接口修改:
req:  {user_id:uuid,caller_phone: s,callee_phone: s,sdp: {ip: ip, port: i},userclass: game,dev_id:d,type:p2p, acc:a, clidata:clidata}
ack: {status:ok,session_id:sid, ip:ip, port:PeerPort, codec_name:"AMR",payload_mode:m,rssrc:rs}
     {status:failed,reason:no_logind/not_actived}
2 phone event接口
post lwork/mobile/voip/dtmf
req: {session_id:s,num:s}
ack: {status:ok}

3 phone event接口
post lwork/mobile/voip/dtmf_with_seq
req: {session_id:s,num:s,seq:seq}  //seq从收到session_id的时候，从1开始
ack: {status:ok}


3 logout接口
post lwork/mobile/logout
req: {uuid: s, device_id:did, clidata:{os_type:"android"}}
ack: {status,ok}

4 被叫呼叫传送消息接口
python push.py "++Acount++" "++CustomContent
CustomConent:   [{event,"p2p_inform_called"},{caller, Caller}, {opdata,Opdata}]  

5 p2p terminal available消息接口
post lwork/mobile/p2p_ringing
req: {opdata:Opdata}
ack: {status:ok}
     {status:failed, reason:"already_call_real_phone"}

6 p2p 接听消息接口
post lwork/mobile/p2p_answer
req: {caller_phone: s, callee_phone: s,sdp: {ip: ip, port: i},userclass: s,opdata:Opdata,clidata:clidata}
ack: {status:ok,session_id:sid, ip:ip, port:PeerPort, codec_name:"AMR",payload_mode:m,rssrc:rs}
     {status:failed, reason:"already_call_real_phone"}     

7 p2p 拒绝消息接口
post lwork/mobile/p2p_reject
req: {opdata:Opdata}
ack: {status:ok}
     {status:failed, reason:"already_call_real_phone"}          

8 被叫p2p_poll接口
post lwork/mobile/p2p_poll
req: {opdata:Opdata}
ack:  [{status, ok}, {peer_status, Status}];   Status: idle/ring/hookoff/p2p_idle/p2p_ring/p2p_hookoff/release

9 注册百度push
post lwork/mobile/baidu_push_register
req: [{caller, s}, {account, s},{user_id, User_id},{channel_id,Channel_id}]
ack: [{status,ok}]

9 dth version
get lwork/mobile/version_dth_no
ack: [{status,ok},{i_version_no,version},{i_version_path,path},{i_version_info,i_info},{version_no,v},{version_path,v},{version_info,v_info}]

9 common version
get lwork/mobile/version_commont_no
ack: [{status,ok}...]

10 start callback
post lwork/mobile1/callback
req: [{uuid,i},{local,s},{remote,s}]
ack: [{status, ok}, {session_id, SID}]

11 stop callback
delete lwork/mobile1/callback
req: [{session_id, SID}]
ack: [{status,ok}]

11 get callback status
get lwork/mobile1/calls/status?session_id=s
ack: [{status,ok}, {local,CallerStatus},{remote,CalleeStatus}]  released表示都释放

12 长连接推送接口
post channel/push_service
req: {acc:acc,device_id:did,self_phone:phone}
ack: {status:ok, data:push_data}  or {status:failed, reason:reason}
    其中push_data是个json的数组,包括以下几种情况：
    1 服务器推送呼叫被叫消息 [{event,"p2p_inform_called"},{caller, Caller}, {opdata,Opdata}]
    2 [{event, "login_otherwhere"}]
    3 [{event,"shake_hand"}]

   
客户端poll服务：收到[]/unlogined/login_otherwhere则

13 sip呼叫终端app消息，推送
push:  [{event,"p2p_inform_called"},{caller, Caller},{opdata,[{event,"sip_call_in"},{caller, Caller}, {callee,Callee},{session_id, sid}, {ip,ip}, {port, PeerPort},{codec_name, cn},{payload_mode, pm},{rssrc, rs}] ]

14 设置邮箱密码
post lwork/mail/set_account
     params: [{uuid,u},{account,i},{mail_acc,s},{mail_pwd,s},{mail_addr,a}]
     ack:  {result:ok} or {result:failed,reason:pwd_not_matched}
15 获取邮件列表 (H5页面)http://10.32.7.28:8188/livecommail/index.html?uuid=136
16 新邮件提醒 推送
push:  {event:"new_email_arrived",mail_acc:m,uids:uids,alert:d,badge:1,'content-available':1}
16 对于android推送，由于推送不可靠,所以需要确认机制，收到一条推送立即回确认消息，如下
post lwork/mail/new_email_arrived_ack
req: {account:account,uids:uids}
ack:  [{status, ok}]

17 新oa提醒 推送 和新邮件类似 event不同而已
push:  {event:"new_oa_arrived",mail_acc:m,uids:uids,alert:d,badge:1,'content-available':1}
18 对于android推送，由于推送不可靠,所以需要确认机制，收到一条推送立即回确认消息，如下
post lwork/mail/new_oa_arrived_ack
req: {account:account,uids:uids}
ack:  [{status, ok}]
    
18 根据uids获取oa提醒内容
post fc2fc.com:8188/mail/get_oa_summary 
params:  {account:"0131000032@livecom",page_num:n,page_index:i}
ack: {status:ok,uids:[{uid:u,Subject:sub,oa_link:link}]}

19 根据uid找到oa_link
get fc2fc.com:8188/mail/get_oa_link?account=a&uid=u
ack: {status:ok,'uid':uid,'oa_link':oa_link}


//以下不要
13 sip呼叫终端app消息，推送
push:  [{event,"sip_call_in"},{caller, Caller}, {callee,Callee},{session_id, sid}, {ip,ip}, {port, PeerPort},{codec_name, cn},{payload_mode, pm},{rssrc, rs}] 

14 sip_ringing  terminal available消息接口
post lwork/mobile/sip_ringing
req: {session_id, sid}
ack: {status:ok}
     {status:failed, reason:"session_not_exist"}

15 sip_call 接听消息接口
post lwork/mobile/sip_answer
req: {session_id:sid,clidata:clidata}
ack: {status:ok}
     {status:failed, reason:"session_not_exist"}     

16 sip_call 拒绝消息接口
post lwork/mobile/sip_reject
req: {session_id:sid}
ack: {status:ok}
     {status:failed, reason:"session_not_exist"}          

17 被叫sip_call 查询接口 和voip呼叫一样
get lwork/mobile/voip/calls?session_id=sid

ack:  [{status, ok}, {peer_status, Status}]idle/ring/hookoff/p2p_idle/p2p_ring/p2p_hookoff/release

获取状态的ack改为：

ack:  [{status, ok}, {peer_status, Status},{stats,Stats}]
      Status: idle/ring/hookoff/p2p_idle/p2p_ring/p2p_hookoff/release
      Stats: 对象[{ip, IP},{pr, CumuR}, {pl, CumuL}, {avgIJ, AvgIJms},{jitter, Jitter}, {avgrttms, AvgRTTms},{rttms,Rttms},{lostrate,Lostrate}
    ]

    界面上实时显示Jitter，Rttms


18 发送验证码
post lwork/sms/auth_code
params: {uuid:UUID, device_id:did,type:"register" or "resetpwd"}
ack: {status:ok}   {status:failed, reason:R}

19 register:
post lwork/mobile/register
params: {uuid:u,device_id:D, auth_code:a, name:n, pwd:p,group_id:g}
ack: {status:ok}   {status:failed, reason:r}

无激活码注册:
post lwork/mobile/self_register
params: {acc:n,name:n, pwd:p,auth_code:a,device_id:D,group_id:g,crc:c}
ack: {status:ok,name:n,account:n,uuid:u,did:""}   {status:failed, reason:r}
crc:md5(acc+device_id+group_id)

20 forget pwd:
post lwork/mobile/forget_pwd
params: {acc:a, uuid:u,device_id:D, auth_code:a,pwd:p,name:n,group_id:g}
ack: {status:ok}   {status:failed, reason:r}  invalid_auth_code/username_not_exist/account_not_exist/

21 modify pwd:
post lwork/mobile/modify_pwd
params: {uuid:u,device_id:D, old_pwd:a,  pwd:p}
ack: {status:ok}   {status:failed, reason:r}

22 add user info :
post lwork/mobile/add_info
params: {uuid:u,device_id:D, info:info}
ack: {status:ok}   {status:failed, reason:r}

login 修改
3 login接口
post lwork/mobile/login
req: {acc: a, pwd: s,device_id:did, clidata:{os_type:"android"},group_id:g}
ack: {status:ok, uuid:u,info:info,{name,Name},{urls,Urls},account:account}
注： account很重要 不能随便改，否则im登录不了，push service也不对，会导致退出。

12 查询被叫在线状态
post lwork/mobile1/query_status
req: {users:[{acc:acc,phone:phone}]}
ack: {status:ok, data:[{acc:acc,phone:phone,state:s}]}  or {status:failed, reason:reason}
 state: online/offline/unregistered

13 第三方账号登陆情况
post: lwork/mobile1/third_login?acc=a
req: {acc: a,pwd:s, crc:c,device_id:did, clidata:{os_type:"android",},group_id:g}
qq登陆接口：
acc: "qq_"+openid
group_id:"dth_common"
crc: md5(acc+device_id+group_id)
pwd:填openid
ack:{status:ok,uuid:u,class:reg or not_reg,name:n,info:info,account:a,did:d}
    {status:failed,reason:crc_invalid}

如果没有注册过，则第三方注册接口:
14 第三方账号注册并登录
post: lwork/mobile1/third_reg?acc=a&name=n
req: {acc:a,name:n,pwd:s, crc:c,device_id:did, clidata:{os_type:"android",},group_id:g}
qq接口：
acc: "qq_"+openid
group_id:"dth_common"
crc: md5(acc+device_id+group_id)
name:用户填
pwd:用户填
ack:{status:ok,uuid:u,name:n,info:info,account:a,did:d}
    {status:failed,reason:crc_invalid or username_already_existed}    

15 获取套餐接口
post: lwork/mobile1/ltalk_package
req:{uuid:u,group_id:"dth_common"}
ack: [{status,ok},{packages,p}]
packages如下内容数组
[{type,dth_basic1},{name,"季度基础套餐"},{price,56},{period,month},{limit,300},{cycles,3}].
[{type,dth_basic2},{name,"年基础套餐"},{price,205},{period,month},{limit,300},{cycles,12}].
[{type,dth_std1},{name,"季度标准套餐"},{price,110},{period,month},{limit,1000},{cycles,3}].
[{type,dth_std2},{name,"年标准套餐"},{price,360},{period,month},{limit,1000},{cycles,12}].
[{type,dth_unlmt1},{name,"季度畅聊套餐"},{price,236},{period,month},{limit,unlimit},{cycles,3}].
[{type,dth_unlmt2},{name,"年畅聊套餐"},{price,732},{period,month},{limit,unlimit},{cycles,12}].



1   dth相关运营工作，包括以下接口实现：
   接口：
1 营帐系统=》lwork  （和羊总相关）
开通：字段  group（填dth） account   pwd
激活： account  
去激活： account
绑定上海联通号码：  account  phone
2  lwork=》营帐系统（和羊总相关）
查询剩余分钟数：   字段：  account  
查询详单：   字段：   account，start/end起始日期/结束日期

3 app=》lwork （和羊总无关）
注册：  字段 account/pwd/username/
注册成功后强制要求用户设置登录密码
登录：      使用username登录，username/pwd
修改密码：  account/oldpwd/newpwd

绑定号码相关接口
1 绑定号码验证码请求：
post lwork/sms/auth_code
   req:  {uuid:u,phone:p,device_id:d,type:"bind"}
   ack:  [{status,failed}, {reason,Reason}] or  {status:ok}
2 绑定号码
post lwork/mobile/bind
    req: {uuid:u,phone:p,device_id:d,auth_code:a}
    ack: [{status,failed},{reason,invalid_auth_code}] or [{status,ok}]
加密接口
1 原有的json字符串，进行base64编码，前面加7个字符，作为新的json的value
req: {data_enc:NewJson}
返回值，方式如下：
原有的json字符串base64编码后的第三个字符后面，插入2个字符，作为新的json的value
ack： {data_enc:NewJson}

自支付相关：
1 查询金币：
post lwork/mobile/get_coin
req: {uuid: u}
ack: {status:ok, coins:c, gift_coins:gc,month_consumed:mc}


2 获取支付订单
post lwork/mobile/get_payid
req: {uuid:u,device_id:dvid,money:m,coins:coins}
ack: {status:ok, payid:payid,uuid:uuid}

3 获取支付明细
post lwork/mobile/get_recharges
req: {uuid:u,device_id:dvid}
ack: {status:ok, recharges:[{year:y,month:m,date:d,hour:h,minute:min,second:s,money:money,coins:coins}]}

1 查询套餐使用情况：
post lwork/mobile/package_usage
req: {uuid: u}
ack: {status:ok, lefts:c, gifts:gc,month_consumed:mc,expir_date:e}

4 获取支付订单
post lwork/mobile/get_types_payid
req: {uuid:u,device_id:dvid,money:m,group_id:g,pay_type:pay_type}
org: "alipay" or "wx"
ack: {status:ok, payid:payid,uuid:uuid}

支付宝回调url:
http://119.29.62.190:8080/lwork/mobile1/paytest/package_pay

回调url:
支付宝：/lwork/mobile1/paytest/package_pay
微信： /lwork/mobile1/paytest/package_pay/ wx

[{id,Id},{caller,Caller},{callee,Callee},{lasttime,LastTime},{times,length(All)},
 {details,[[{starttime,TimeStr},{duration,Dura},{direction,Direction}]]}]
5 apple pay(iap) 终端付费通知
post /lwork/mobile1/paytest/package_pay/apple
req: {uuid:u,payid:payid,device_id:dvid,money:m,receipt:base64ed}
ack: {status:ok}  {status:failed,reason:reason}


for zhiyu
获取直币订单号接口
1 获取支付订单
post lwork/mobile/gen_zy_coin_payid
req: {uuid:u,device_id:dvid,money:m,group_id:g,pay_type:pay_type}
ack: {status:ok, payid:payid,uuid:uuid}

2 获取升级信息
get lwork/mobile/version_common_no
例子:
curl -i -X GET   https://lwork.hk/lwork/mobile/version_common_no

3 获取费率
post lwork/mobile/voip/rate
req: {uuid:u,device_id:dvid,callee:callee}
ack: {status:ok, rate:Rate}
例子：
curl -i -H 'content-type: application/json' -X POST -d '{"user_id":"18017813673","callee_phone":"0085218017813673","device_id":"18017813673"}}'   https://lwork.hk/lwork/mobile/voip/rate

4 获取话单
用中兴ltalk的接口即可，如下：
post URL:http://lwork.hk:8091/service.yaws
req: form格式  command=load_employer_detail&companyid=15&employerid=31271186&t=1475130151405
ack: [{"caller":"13913841060","called":"008613913841031","start_time":"2016-9-25-19-1-39","end_time":"2016-9-25-19-2-26","cost":"1.00",charge:c,pkg_minutes:p,"recurl":""}]
例子:
curl -i -X POST -d 'command=load_employer_detail&companyid=15&employerid=31271186'   http://lwork.hk:8091/service.yaws