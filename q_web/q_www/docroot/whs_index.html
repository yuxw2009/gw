<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>武汉服务外包企业通信平台登录页面</title>
<link rel="stylesheet" type="text/css" href="style/whs_login.css" />
</head>
<body>
 <div class="cloud_bg">
 <div class="body_bg">

<div id="contianer">
  <div id="header">
    <div class="logo"></div>
    <div class="xcy"></div>
  </div>
  <div class="clear"></div>
  <div class="content">
    <div class="whs_list">
      <dl>
        <dd><span class="list_icon"></span>降低企业对IT及业务系统的投入</dd>
      </dl>
      <dl>
        <dd><span class="list_icon"></span>提供了便捷的企业全球通讯工具</dd>
      </dl>
      <dl>
        <dd><span class="list_icon"></span>为企业提供了可跟踪的项目管理能力</dd>
      </dl>
      <dl>
        <dd><span class="list_icon"></span>实现移动、异地融合办公, 消除地域界限</dd>
      </dl>
      <dl>
        <dd><span class="list_icon"></span>为员工提供了知识积累和共享的平台</dd>
      </dl>            
      <dl class="tel"> 
        <dt></dt>
<!--        <dd><h3>客服服务</h3><dd>
        <dd>客服电话：4007-360-666<dd>
        <dd>反馈邮箱：<a href="mailto:service@wuhansourcing.gog.cn">service@wuhansourcing.gov.cn</a>
        <dd>-->
      </dl>
      
      <dl class="tel"> 
        <dd><img src="images/whsfoot_xcy.png" width="606" height="50" /><dd>
      </dl>
            
    </div>
    <div class="whs_login">    
      <ul>
        <li>
          <label class="comp_icon"></label>
          <span class="input_box">
          <input class="company" type="text" value="wuhansourcing" />
          </span>
        </li>
        <li>
          <label class="person"></label>
            <span class="input_box">
          <input class="usename" type="text" value="输入账号" />
          </span>
        </li>
        <li>
          <label class="pas_tip"></label>
         <span class="input_box">
          <input class="password" type="password" value="" />
          </span>
          <span class="pssword_tip">输入密码</span> </li>
      </ul>
      <div id="tips">账号不能为空！</div>
      <div class="submit_con"><a type="submit" id="submit" class="btn" href="###"></a></div>
    </div>
  </div>
</div>
</div>
 </div>
</body>
<script type="text/javascript" src="script/jquery-1.6.3.min.js"></script>
<script type="text/javascript" src="script/jquery.cookie.js?t=20120528"></script>
<script type="text/javascript" src="script/json2.js"></script>
<script type="text/javascript" src="script/md5.js"></script>
<script type="text/ecmascript">
		// 文本框插件			   
		$.fn.searchInput = function (options) {
			var defaults = {
				color: "#2c628b",
				defaultcolor: "#2c628b",
				defalutText: ""
			},
				params = $.extend(defaults, options || {}),
				_this = $(this);
			_this.css("color", params.defaultcolor);
			_this.focus(function () {
			 if ("" === _this.val() || _this.val() === params.defalutText){		
				_this.val("");
				_this.css("color", params.color);
			  }
			}).blur(function () {
				if ("" == _this.val()) {
					_this.css("color", params.defaultcolor);
					_this.val(params.defalutText);
				}
			})
		}


    var setHeight=function(){
		var clientHeight = document.documentElement.clientHeight > document.body.clientHeight ? document.documentElement.clientHeight :document.body.clientHeight;
        $('.cloud_bg').css('min-height', clientHeight);
	}
	 	$('#contianer').find('.company').eq(0).searchInput({
	 		defalutText:"公司名称"
	 	});
	 	$('#contianer').find('.usename').eq(0).searchInput({
	 		defalutText:"输入账号"
	 	});
		$('.password').focus(function(){
			$('.pssword_tip').hide();
		}).blur(function(){
			if($(this).val() === ''){
			 $('.pssword_tip').show();
			}
		})
		 $('.pssword_tip').click(function(){
			 $('.password').focus();			 
		 })		

	var autoFillInput=function(){
	 	var company = $.cookie('company'),
	 	    account = $.cookie('account');
	 	$('#contianer').find('input.company').focus();
	 	if (company){
	 		$('#contianer').find('input.company').val(company.toString());
		 	$('#contianer').find('input.usename').focus();
		}
		if (account){
		 	$('#contianer').find('input.usename').val(account.toString());
		 	$('#contianer').find('input.password').focus();
		}
	}
	setHeight();
	autoFillInput();	
    var save2Cookie = function(company, account, password, uuid){	
		$.cookie('company',company, {expires: 30});
		$.cookie('account',account, {expires: 30});
		$.cookie('password', password, {expires: 30});		
		$.cookie('uuid',uuid);
    }
    var doLogin = function(company, account, passwordMD5, failCallback){
     	var url = '/lwork/auth/login';
		var data = {'company':company, 'account': account,'password': passwordMD5, 't': new Date().getTime()};
     	$.post(url,JSON.stringify(data),function(data){
					if(data.status === 'ok'){
					   save2Cookie(company, account, passwordMD5, data['uuid']);
					   window.location = "lwork.yaws?uuid=" + data['uuid'];	     
					}else{
						if (failCallback){
							failCallback(data.reason);
						}
					}
			   })
    }
    var tryAutoLogin=function(){
     	var company = $.cookie('company'),
     	    account = $.cookie('account'),
     	    passwordMD5 = $.cookie('password');
     	if (company && account && passwordMD5){
	     	doLogin(company, account, passwordMD5, function(){
	     		autoFillInput();
	     	});
        }
    }
    tryAutoLogin();
	window.onresize =setHeight;
	$('input.usename ,input.password').keyup(function(event){	
	    e = event ? event : (window.event ? window.event : null);
		if (e.keyCode != 13) {		 
		   $('#tips').hide();
		   return false;
		}

	})		  

	$('#submit').click(function(){
		var company = $('input.company').val(), 
		    account = $('input.usename').val(),
		    password = $('input.password').val();

		if (''===company){
			$('#tips').text('公司号不能为空！').show();
		    $('input.company').focus();
		    return false;
		}else{
			company = company.toLowerCase();
		}
		if(''===account || account === '输入账号'){
		  $('#tips').text('账号不能为空！').show();
		  $('input.usename').focus();
		  return false;
		}
		if(''===password){
		  $('#tips').text('密码不能为空！').show();		 
		  $('input.password').focus();
		    return false;

		}
		doLogin(company, account, md5(password), function(failReason){
			if(failReason === 'wrong_auth'){	
			     $('#tips').text('用户名或密码有误，请重新输入！').show();
			     $('input.usename').val('').focus();
		         $('input.usename').val('');
		         $('input.password').val('');
			}else{
			     $('#tips').text('该账号在别的地方已经登录过了！').show();
		         $('input.usename').focus();						  
			}
		});
	});	
	
	document.onkeydown = function (event) {
    e = event ? event : (window.event ? window.event : null);
    if (e.keyCode == 13) {
            $('#submit').click()
            return false;
        }
    }

</script>
</html>


</html>
